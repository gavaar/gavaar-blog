<form
  class="habit-card"
  [class.saving]="saving()"
  [formGroup]="habitForm"
  [style.--habit-card-selection-color]="`var(--habit-card-success-color-${habitFormValue()?.effort}, var(--disabled))`"
>
  <div class="habit-card__info">
    <div class="habit-card__task-title">
      <gav-icon [icon]="habit().icon" />
      <h5>{{ habit().title }}</h5>
      <small>[ {{ habit().id }} ]</small>
    </div>

    <div class="habit-card__goal">
      @if (!habit().goal) {
        <gav-icon class="disabled" icon="target" />
        <gav-input
          [formControl]="newGoalForm"
          [options]="{ placeholder: 'Set a measurable short-term goal for this habit' }"
        />
        <gav-icon
          icon="checkmark"
          [class.disabled]="newGoalForm.invalid"
          (click)="submitNewGoal()"
        />
      } @else {
        @let goal = habit().goal!;
        @let showStreak = goal.streak > 3;
        @let showEffort = goal.effort > 3;

        <gav-icon icon="target" />
        <span>{{ goal.title }}</span>
        @if (showStreak) {
          <span class="habit-card__goal-streak">
            {{ goal.streak }}
            <gav-icon icon="flame" />
          </span>
        }
        @if (showEffort) {
          <span class="habit-card__goal-effort">
            {{ goal.effort }}
            <gav-icon icon="upload" />
          </span>
        }
      }
    </div>

    <small>{{ habit().description }}</small>

    <gav-input
      class="habit-card__input"
      formControlName="message"
      type="textarea"
      [options]="{ placeholder: 'context about today\'s score' }"
    />

    <div class="habit-card__last-weeks">
      @let weeks = habit().lastWeeks || {};

      @for (day of lastWeeks; track day) {
        @let doneDayValue = weeks[day]?.done;
        <span
          [style.background-color]="`var(--habit-card-success-color-${doneDayValue}, darkgray)`"
          [class.today]="selectedDayService.selectedTimestamp() == day">
        </span>
      }
    </div>
  </div>

  <div class="habit-card__slider">
    <div class="habit-card__slider-value">
      <span>
        {{ habitFormValue()?.effort ?? '-' }}
      </span>
    </div>
    <gav-input
      type="slider"
      formControlName="effort"
    />
  </div>

  @if (!habitIsReset()) {
    <button class="habit-card__save-button round-button" (click)="patchHabit()">
      <gav-icon icon="save" />
    </button>
    <button class="habit-card__rewind-button round-button" (click)="resetHabit()">
      <gav-icon icon="rewind" />
    </button>
  }

  <div class="habit-card__option-buttons">
    <ng-content />
  </div>
</form>
